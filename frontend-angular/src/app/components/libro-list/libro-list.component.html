<div class="container mt-4">
  <h2 class="mb-4">
    <i class="bi bi-journal-text"></i> Catálogo de Libros
  </h2>

  <!-- Mensajes de éxito/error -->
  <div class="alert alert-success alert-dismissible fade show" role="alert" *ngIf="successMessage">
    <i class="bi bi-check-circle"></i> {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
  </div>

  <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="error">
    <i class="bi bi-exclamation-triangle"></i> {{ error }}
    <button type="button" class="btn-close" (click)="error = ''" aria-label="Close"></button>
  </div>

  <!-- Filtros -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <i class="bi bi-funnel"></i> Filtros de Búsqueda
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Buscar por título o autor</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="searchTerm"
            placeholder="Ej: Don Quijote"
            (keyup.enter)="applyFilters()">
        </div>
        <div class="col-md-3">
          <label class="form-label">Género</label>
          <select class="form-select" [(ngModel)]="selectedGenero">
            <option value="">Todos</option>
            <option *ngFor="let genero of generos" [value]="genero">{{ genero }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Disponibilidad</label>
          <select class="form-select" [(ngModel)]="selectedDisponibilidad">
            <option value="">Todos</option>
            <option value="true">Disponible</option>
            <option value="false">No disponible</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-primary w-100 me-2" (click)="applyFilters()">
            <i class="bi bi-search"></i> Buscar
          </button>
          <button class="btn btn-secondary w-100" (click)="clearFilters()">
            <i class="bi bi-x-circle"></i> Limpiar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Botón agregar nuevo -->
  <div class="mb-3">
    <a routerLink="/nuevo" class="btn btn-success">
      <i class="bi bi-plus-circle"></i> Agregar Nuevo Libro
    </a>
  </div>

  <!-- Loading Spinner -->
  <div class="spinner-container" *ngIf="loading">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Grid de Libros (Catálogo) -->
  <div class="libros-grid" *ngIf="!loading && libros.length > 0">
    <div class="row g-4">
      <div class="col-12 col-sm-6 col-lg-4" *ngFor="let libro of libros">
        <div class="libro-card h-100">
          <!-- Card Header con imagen placeholder -->
          <div class="libro-card-image">
            <img 
              [src]="libro.portada || 'https://via.placeholder.com/300x400?text=Sin+Portada'"
              [alt]="libro.titulo" 
              class="img-fluid">
            <div class="libro-card-overlay">
              <button
                class="btn btn-sm btn-info"
                (click)="verDetalle(libro._id)"
                title="Ver detalle">
                <i class="bi bi-eye"></i> Ver Detalle
              </button>
            </div>
          </div>

          <!-- Card Body -->
          <div class="libro-card-body">
            <!-- Título -->
            <h5 class="libro-titulo" [title]="libro.titulo">
              {{ libro.titulo | slice:0:50 }}{{ libro.titulo.length > 50 ? '...' : '' }}
            </h5>

            <!-- Autor y Editorial -->
            <p class="libro-autor">
              <strong>{{ libro.autor }}</strong>
            </p>
            <p class="libro-editorial text-muted small">
              {{ libro.editorial }}
            </p>

            <!-- Año -->
            <p class="libro-ano text-muted small mb-3">
              <i class="bi bi-calendar"></i> {{ libro.anioPublicacion }}
            </p>

            <!-- Géneros -->
            <div class="libro-generos mb-3">
              <span class="badge bg-info" *ngFor="let genero of libro.generos.slice(0, 3)">
                {{ genero }}
              </span>
              <span class="badge bg-secondary" *ngIf="libro.generos.length > 3">
                +{{ libro.generos.length - 3 }}
              </span>
            </div>

            <!-- Separador -->
            <hr class="my-3">

            <!-- Precio -->
            <div class="libro-precio mb-3">
              <span class="precio-valor">{{ libro.precio | currency:'EUR' }}</span>
            </div>

            <!-- Stock y Disponibilidad -->
            <div class="libro-estado mb-3">
              <div class="estado-item">
                <small class="text-muted">Stock:</small>
                <span class="badge" [ngClass]="libro.stock > 0 ? 'bg-success' : 'bg-danger'">
                  {{ libro.stock }} unidades
                </span>
              </div>
              <div class="estado-item">
                <small class="text-muted">Estado:</small>
                <span class="badge" [ngClass]="libro.disponible ? 'bg-success' : 'bg-danger'">
                  {{ libro.disponible ? 'Disponible' : 'No disponible' }}
                </span>
              </div>
            </div>
          </div>

          <!-- Card Footer con Acciones -->
          <div class="libro-card-footer">
            <button
              class="btn btn-sm btn-outline-warning flex-grow-1"
              (click)="editarLibro(libro._id)"
              title="Editar">
              <i class="bi bi-pencil"></i> Editar
            </button>
            <button
              class="btn btn-sm btn-outline-danger flex-grow-1"
              (click)="eliminarLibro(libro._id, libro.titulo)"
              title="Eliminar">
              <i class="bi bi-trash"></i> Eliminar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje si no hay libros -->
  <div class="alert-empty" *ngIf="!loading && libros.length === 0">
    <i class="bi bi-info-circle"></i>
    <span>No se encontraron libros con los filtros aplicados.</span>
  </div>

  <!-- Paginación -->
  <nav *ngIf="!loading && libros.length > 0">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="changePage(currentPage - 1)" href="javascript:void(0)">
          <i class="bi bi-chevron-left"></i> Anterior
        </a>
      </li>
      <li class="page-item" *ngFor="let page of getPagesArray()" [class.active]="page === currentPage">
        <a class="page-link" (click)="changePage(page)" href="javascript:void(0)">
          {{ page }}
        </a>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="changePage(currentPage + 1)" href="javascript:void(0)">
          Siguiente <i class="bi bi-chevron-right"></i>
        </a>
      </li>
    </ul>
    <p class="text-center text-muted">
      Mostrando página {{ currentPage }} de {{ totalPages }} (Total: {{ totalLibros }} libros)
    </p>
  </nav>
</div>

