<div class="container mt-4">
  <h2 class="mb-4">
    <i class="bi bi-journal-text"></i> Catálogo de Libros
  </h2>

  <!-- Mensajes de éxito/error -->
  <div class="alert alert-success alert-dismissible fade show" role="alert" *ngIf="successMessage">
    <i class="bi bi-check-circle"></i> {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
  </div>

  <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="error">
    <i class="bi bi-exclamation-triangle"></i> {{ error }}
    <button type="button" class="btn-close" (click)="error = ''" aria-label="Close"></button>
  </div>

  <!-- Filtros -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <i class="bi bi-funnel"></i> Filtros de Búsqueda
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Buscar por título o autor</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="searchTerm"
            placeholder="Ej: Don Quijote"
            (keyup.enter)="applyFilters()">
        </div>
        <div class="col-md-3">
          <label class="form-label">Género</label>
          <select class="form-select" [(ngModel)]="selectedGenero">
            <option value="">Todos</option>
            <option *ngFor="let genero of generos" [value]="genero">{{ genero }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Disponibilidad</label>
          <select class="form-select" [(ngModel)]="selectedDisponibilidad">
            <option value="">Todos</option>
            <option value="true">Disponible</option>
            <option value="false">No disponible</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-primary w-100 me-2" (click)="applyFilters()">
            <i class="bi bi-search"></i> Buscar
          </button>
          <button class="btn btn-secondary w-100" (click)="clearFilters()">
            <i class="bi bi-x-circle"></i> Limpiar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Botón agregar nuevo -->
  <div class="mb-3">
    <a routerLink="/nuevo" class="btn btn-success">
      <i class="bi bi-plus-circle"></i> Agregar Nuevo Libro
    </a>
  </div>

  <!-- Loading Spinner -->
  <div class="spinner-container" *ngIf="loading">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Tabla de Libros -->
  <div class="table-responsive" *ngIf="!loading && libros.length > 0">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>ISBN</th>
          <th>Título</th>
          <th>Autor</th>
          <th>Editorial</th>
          <th>Año</th>
          <th>Género</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let libro of libros">
          <td>{{ libro.isbn }}</td>
          <td><strong>{{ libro.titulo }}</strong></td>
          <td>{{ libro.autor }}</td>
          <td>{{ libro.editorial }}</td>
          <td>{{ libro.anioPublicacion }}</td>
          <td>
            <span class="badge bg-info" *ngFor="let genero of libro.generos.slice(0, 2)">
              {{ genero }}
            </span>
          </td>
          <td>{{ libro.precio | currency:'EUR' }}</td>
          <td>
            <span class="badge" [ngClass]="libro.stock > 0 ? 'bg-success' : 'bg-danger'">
              {{ libro.stock }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="libro.disponible ? 'bg-success' : 'bg-danger'">
              {{ libro.disponible ? 'Disponible' : 'No disponible' }}
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <button
                class="btn btn-sm btn-info"
                (click)="verDetalle(libro._id)"
                title="Ver detalle">
                <i class="bi bi-eye"></i>
              </button>
              <button
                class="btn btn-sm btn-warning"
                (click)="editarLibro(libro._id)"
                title="Editar">
                <i class="bi bi-pencil"></i>
              </button>
              <button
                class="btn btn-sm btn-danger"
                (click)="eliminarLibro(libro._id, libro.titulo)"
                title="Eliminar">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mensaje si no hay libros -->
  <div class="alert alert-info" *ngIf="!loading && libros.length === 0">
    <i class="bi bi-info-circle"></i> No se encontraron libros con los filtros aplicados.
  </div>

  <!-- Paginación -->
  <nav *ngIf="!loading && libros.length > 0">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="changePage(currentPage - 1)" href="javascript:void(0)">
          <i class="bi bi-chevron-left"></i> Anterior
        </a>
      </li>
      <li class="page-item" *ngFor="let page of getPagesArray()" [class.active]="page === currentPage">
        <a class="page-link" (click)="changePage(page)" href="javascript:void(0)">
          {{ page }}
        </a>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="changePage(currentPage + 1)" href="javascript:void(0)">
          Siguiente <i class="bi bi-chevron-right"></i>
        </a>
      </li>
    </ul>
    <p class="text-center text-muted">
      Mostrando página {{ currentPage }} de {{ totalPages }} (Total: {{ totalLibros }} libros)
    </p>
  </nav>
</div>

